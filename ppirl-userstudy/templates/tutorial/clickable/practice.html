<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>PPIRL</title>
        <link rel="shortcut icon" href="/static/images/site/favicon.ico" type="image/x-icon" />

        <link rel="stylesheet" href="/static/css/site.css?q=2" type="text/css">
        <link rel="stylesheet" href="/static/css/style.css?q=52" type="text/css">
        <link rel="stylesheet" href="/static/css/ionicons.min.css" type="text/css">
        <link rel="stylesheet" href="/static/css/select.css?q=13" type="text/css">
        <link rel="stylesheet" href="/static/css/bootstrap.min.css" type="text/css">
        <link rel="stylesheet" href="/static/css/footer.css" type="text/css">
        <link rel="stylesheet" href="/static/css/animate.min.css">

        <script src="/static/javascript/jquery-3.2.1.min.js"></script>
        <script src="/static/javascript/popper.min.js"></script>
        <script src="/static/javascript/bootstrap.min.js"></script>
        <script src="/static/javascript/site.js"></script>
        <script src="/static/javascript/choice_panel.js?v=4"></script>
        <script src="/static/javascript/grading.js?v=1"></script>
        <script src="/static/javascript/clickable.js?v=14"></script>
        <script src="/static/javascript/form_submit.js"></script>
        <script type=text/javascript>
            $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
            $THIS_URL = "{{ thisurl }}";
            $NEXT_URL = $SCRIPT_ROOT + "{{ url_for('next') }}";

            var dt = new Date();
            $timestamp = Math.round(dt.getTime()/1000);
            $user_data = "uid:{{ uid }},type:main_section_start,value:"+$timestamp+",timestamp:"+$timestamp+",url:" + $THIS_URL + ";";
            //$user_data = "";
            $DELTA = {
            {% for d in delta %}
                "{{ d[0] }}":{{ d[1]}},
            {% endfor %}
            };
            $KAPR_LIMIT = {{ kapr_limit }};
            $KAPR = 0;
            $USTUDY_MODE = {{ ustudy_mode }};

            // $(window).on("beforeunload", function() {
            //     return "Are you sure? You will lose all the date if you leave!";
            // });
        </script>
    </head>

    <body>
        <div id="wrapper">
            <div id="title">
                <h3>{{ title }}</h3>
            </div>
            
            <div id="content">
                <div class="tool-bar">
                {% if ustudy_mode in ['3','4'] %}
                <div class="privacy-budget-div">
                    <script>
                        $(function() {
                            $("[title]").tooltip({'placement': "bottom"});
                        });
                    </script>
                    <div>Privacy risk: <span id="privacy-risk-value">{{ kapr }}%</span><span id="privacy-risk-delta-value"></span></div>
                    <!-- <div class="progress border" style="height: 20px; width: 800px"> -->
                        <div class="progress border">
                        {% if kapr_limit > 0 %}
                        <div style="width: 6px; height: 18px; position: absolute; background: red; margin-left: {{ kapr_limit*16 }}px;" title="privacy risk cannot exceed this limit">
                        </div>
                        {% endif %}
                        <div id="privacy-risk-bar" class="progress-bar progress-bar-striped bg-info" role="progressbar" style="width: {{ kapr }}%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"></div>
                        <div id="privacy-risk-delta" class="progress-bar bg-warning" role="progressbar" style="width: 0%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                        
                    </div>
                </div>
                {% else %}
                <div class="privacy-budget-div-empty">
                </div>
                {% endif %}
                <!-- <div id="page-number" class="page-number-div">
                    page: <span id="page-number">{{ page_number }}</span>
                </div> -->
                </div>
                <div style="clear:both"></div>
                <div id="table">
                    <div id="table_head">
                        <div class="table_col1">Pair</div>
                        <div class="table_col2">ID</div>
                        <div class="table_col3">FFreq</div>
                        <div class="table_col4 table_names">First Name</div>
                        <div class="table_col4_5 hidden_element">s</div>
                        <div class="table_col5 table_names">Last Name</div>
                        <div class="table_col6">LFreq</div>
                        <div class="table_col7">DoB(M/D/Y)</div>
                        <div class="table_col8">Sex</div>
                        <div class="table_col9">Race</div>
                        <div class="table_col10">Choice Panel</div>
                    </div>
                    <div id="table_content">
                        {% for r in data %}
                            {% if loop.index is divisibleby 2 %}
                        <div class="table_row table_row_even">
                            {% else %}
                        <div class="table_row table_row_odd">
                            {% endif %}
                            <div class="table_col1 pair_number">{{ loop.index0+pair_num_base }}</div>
                            <div class="table_col2 clickable_cell" id = "test_col" mode="masked">
                                <div class="sub_row1" id="{{ ids[loop.index0][0][0] }}">
                                    {{ r[0][1]|safe }}
                                </div>
                                <div class="sub_row2">
                                    {{ icons[loop.index0][0]|safe }}
                                </div>
                                <div class="sub_row3" id="{{ ids[loop.index0][1][0] }}">
                                    {{ r[1][1]|safe }}
                                </div>
                            </div>
                            <div class="table_col3">
                                <div class="sub_row1 tooltip1">
                                    {{ r[0][2]|safe }}
                                    <span class="tooltiptext1">
                                        {% if 'infinity' in r[0][2] %}
                                            Very common
                                        {% elif 'common' in r[0][2] %}
                                            Common name
                                        {% elif 'rare' in r[0][2] %}
                                            Rare name
                                        {% else %}
                                            Unique name
                                        {% endif %}
                                    </span>
                                </div>
                                <div class="sub_row2">
                                </div>
                                <div class="sub_row3  tooltip1">
                                    {{ r[1][2]|safe }}
                                    <span class="tooltiptext1">
                                        {% if 'infinity' in r[1][2] %}
                                            Very common
                                        {% elif 'common' in r[1][2] %}
                                            Common name
                                        {% elif 'rare' in r[1][2] %}
                                            Rare name
                                        {% else %}
                                            Unique name
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                            
                            <div class="{% if 'name_swap' in icons[loop.index0][2] %}names_big_cell clickable_big_cell{% endif %}">
                            <div class="table_col4 table_names {% if 'name_swap' not in icons[loop.index0][2] %}clickable_cell{% endif %}" mode="masked">
                                <div class="sub_row1" id="{{ ids[loop.index0][0][1] }}">
                                    {{ r[0][3]|safe }}
                                </div>
                                <div class="sub_row2">
                                    {{ icons[loop.index0][1]|safe }}
                                </div>
                                <div class="sub_row3" id="{{ ids[loop.index0][1][1] }}">
                                    {{ r[1][3]|safe }}
                                </div>
                            </div>
                            <div class="table_col4_5">
                                {{ icons[loop.index0][2]|safe }}
                            </div>
                            <div class="table_col5 table_names {% if 'name_swap' not in icons[loop.index0][2] %}clickable_cell{% endif %}" mode="masked">
                                <div class="sub_row1" id="{{ ids[loop.index0][0][2] }}">
                                    {{ r[0][4]|safe }}
                                </div>
                                <div class="sub_row2">
                                    {{ icons[loop.index0][3]|safe }}
                                </div>
                                <div class="sub_row3" id="{{ ids[loop.index0][1][2] }}">
                                    {{ r[1][4]|safe }}
                                </div>
                            </div>
                            </div>
                            <div class="table_col6">
                                <div class="sub_row1 tooltip1">
                                    {{ r[0][5]|safe }}
                                    <span class="tooltiptext1">
                                        {% if 'infinity' in r[0][5] %}
                                            Very common
                                        {% elif 'common' in r[0][5] %}
                                            Common name
                                        {% elif 'rare' in r[0][5] %}
                                            Rare name
                                        {% else %}
                                            Unique name
                                        {% endif %}
                                    </span>
                                </div>
                                <div class="sub_row2">
                                </div>
                                <div class="sub_row3 tooltip1">
                                    {{ r[1][5]|safe }}
                                    <span class="tooltiptext1">
                                        {% if 'infinity' in r[1][5] %}
                                            Very common
                                        {% elif 'common' in r[1][5] %}
                                            Common name
                                        {% elif 'rare' in r[1][5] %}
                                            Rare name
                                        {% else %}
                                            Unique name
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                            <div class="table_col7 clickable_cell" mode="masked">
                                <div class="sub_row1" id="{{ ids[loop.index0][0][3] }}">
                                    {{ r[0][6]|safe }}
                                </div>
                                <div class="sub_row2">
                                    {{ icons[loop.index0][4]|safe }}
                                </div>
                                <div class="sub_row3" id="{{ ids[loop.index0][1][3] }}">
                                    {{ r[1][6]|safe }}
                                </div>
                            </div>
                            <div class="table_col8 clickable_cell" mode="masked">
                                <div class="sub_row1" id="{{ ids[loop.index0][0][4] }}">
                                    {{ r[0][7]|safe }}
                                </div>
                                <div class="sub_row2">
                                    {{ icons[loop.index0][5]|safe }}
                                </div>
                                <div class="sub_row3" id="{{ ids[loop.index0][1][4] }}">
                                    {{ r[1][7]|safe }}
                                </div>
                            </div>
                            <div class="table_col9 clickable_cell" mode="masked">
                                <div class="sub_row1" id="{{ ids[loop.index0][0][5] }}">
                                    {{ r[0][8]|safe }}
                                </div>
                                <div class="sub_row2">
                                    {{ icons[loop.index0][6]|safe }}
                                </div>
                                <div class="sub_row3" id="{{ ids[loop.index0][1][5] }}">
                                    {{ r[1][8]|safe }}
                                </div>
                            </div>
                            <div class="table_col10">
                                <div class="choice-panel">
                                    <div class="choice-label">
                                        <span class="fill"></span>
                                        <span>H</span>
                                        <span class="fill"></span>
                                        <span>M</span>
                                        <span class="fill"></span>
                                        <span>L</span>
                                        <span class="fill"></span>
                                        <span>L</span>
                                        <span class="fill"></span>
                                        <span>M</span>
                                        <span class="fill"></span>
                                        <span>H</span>
                                        <span class="fill"></span>
                                    </div>
                                    <br/>
                                    <ul class="mrate choice-button">
                                        <li class="ion-android-arrow-back"></li>
                                        <li class="ion-android-radio-button-off input_radio pair1" id="q{{ r[0][0]|safe }}a1"></li>
                                        <li class="ion-android-remove"></li>
                                        <li class="ion-android-radio-button-off input_radio pair1" id="q{{ r[0][0]|safe }}a2"></li>
                                        <li class="ion-android-remove"></li>
                                        <li class="ion-android-radio-button-off input_radio pair1" id="q{{ r[0][0]|safe }}a3"></li>
                                        <li class="ion-android-add"></li>
                                        <li class="ion-android-radio-button-off input_radio pair1" id="q{{ r[0][0]|safe }}a4"></li>
                                        <li class="ion-android-remove"></li>
                                        <li class="ion-android-radio-button-off input_radio pair1" id="q{{ r[0][0]|safe }}a5"></li>
                                        <li class="ion-android-remove"></li>
                                        <li class="ion-android-radio-button-off input_radio pair1" id="q{{ r[0][0]|safe }}a6"></li>
                                        <li class="ion-android-arrow-forward"></li>
                                    </ul>
                                    <br/>
                                    <ul class="choice-result">
                                        <li class="diff">Different</li>
                                        <li class="same">Same</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div style="clear:both"></div>
                        {% endfor %}
                    </div>
                </div>

                <div id="feedback"  style="font-size: 20px;">
                </div>

                <div class="submit_div">
                    <button id="submit_btn" class="submit_button">Submit</button>
                    <button id="button_next" class="submit_button"  style="display: none;">Next</button>
                </div>
            </div>
            <!-- End of div content -->
        </div>
        <!-- End of div wrapper -->
        {% include "/tutorial/footer.html" ignore missing %}
    </body>


    <script>

        
        function change_feedback(text){
            var feedback = $("#feedback");
            feedback.fadeOut(500, function(){
              feedback.html("<h5>" + text + "</h5>");  
              feedback.css("color","#660000");
            })
            
            feedback.fadeIn(500);
        }
        
         $(".clickable_cell").click(function(){
            var ustudy_mode = {{ ustudy_mode }}
            var id = $(this).children().attr("id");
            var mode = $(this).attr("mode");
             
            var delta = $("#privacy-risk-delta-value").text().replace("%","").replace("+","").trim();
            var expenditure = $("#privacy-risk-value").text().replace("%","").trim();
            delta = parseFloat(delta);
            expenditure = parseFloat(expenditure);
            if(isNaN(expenditure)){
                expenditure = 0;
            }
            console.log(expenditure, delta, expenditure+delta, ustudy_mode, ustudy_mode+10);
            if(mode == "full"){
                change_feedback("You have already opened this cell!");
            } else if((expenditure + delta <= 20.0 && ustudy_mode == 4) || 
                      (ustudy_mode != 4)){
                var wrong_response = "Did you need to open this cell?"; 
                var correct_response = "Good choice! We do need to open that cell.";
                
                if((id === "50056-1-4" && mode === "masked") ||
                   (id === "50056-1-3" && mode === "masked") ||
                   (id === "50056-1-2" && mode === "masked") ||
                   (id === "50055-1-4") ||
                   (id === "50057-1-4") ||
                   (id === "50057-1-1")) {
                    change_feedback(correct_response);             
                } else {
                   change_feedback(wrong_response);                      
                }
            } else{
                change_feedback("Sorry, you do not have enough budget left to open this cell.");
            }

             // change_feedback("Did you need open "+id+"?");  
              
             
         })

        
    </script>


</html>